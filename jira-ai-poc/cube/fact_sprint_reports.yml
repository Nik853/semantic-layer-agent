cubes:
  - name: fact_sprint_reports
    sql_table: public.fact_sprint_reports
    title: Sprint Reports Analytics
    description: |
      Отчеты по спринтам для velocity и burndown.
      KPI: Sprint Velocity, Committed vs Completed, Burndown.
    
    meta:
      keywords:
        ru: ["спринт", "velocity", "скорость команды", "burndown", "выполнение спринта"]
        en: ["sprint", "velocity", "team speed", "burndown", "sprint completion"]
      intent: analytics

    dimensions:
      - name: report_id
        sql: report_id
        type: number
        primary_key: true

      - name: sprint_id
        sql: sprint_id
        type: number

      - name: sprint_name
        sql: sprint_name
        type: string
        title: Sprint Name
        meta:
          keywords:
            ru: ["спринт", "итерация", "по спринтам"]
            en: ["sprint", "iteration", "by sprint"]
          filter: true

      - name: sprint_goal
        sql: sprint_goal
        type: string
        title: Sprint Goal

      - name: sprint_status
        sql: sprint_status
        type: string
        title: Sprint Status
        meta:
          keywords:
            ru: ["активный", "закрытый", "статус спринта"]
            en: ["active", "closed", "sprint status"]
          filter: true

      - name: start_date
        sql: start_date
        type: time
        title: Start Date
        meta:
          supports_date_range: true

      - name: end_date
        sql: end_date
        type: time
        title: End Date

      - name: board_id
        sql: board_id
        type: number

      - name: board_name
        sql: board_name
        type: string
        title: Board Name

      - name: board_type
        sql: board_type
        type: string

      - name: project_id
        sql: project_id
        type: number

      - name: project_key
        sql: project_key
        type: string
        title: Project Key
        meta:
          keywords:
            ru: ["проект", "по проекту"]
            en: ["project", "by project"]
          filter: true

      - name: project_name
        sql: project_name
        type: string
        title: Project Name

      - name: burndown_data
        sql: "burndown_data::text"
        type: string
        title: Burndown Data (JSON)
        meta:
          keywords:
            ru: ["burndown", "график сгорания"]
            en: ["burndown", "burndown chart"]

      - name: velocity_data
        sql: "velocity_data::text"
        type: string
        title: Velocity Data (JSON)

    measures:
      - name: total_committed_points
        sql: committed_points
        type: sum
        title: Total Committed Points
        meta:
          keywords:
            ru: ["committed", "запланировано", "взято в спринт"]
            en: ["committed", "planned", "taken to sprint"]

      - name: total_completed_points
        sql: completed_points
        type: sum
        title: Total Completed Points
        meta:
          keywords:
            ru: ["completed", "выполнено", "завершено в спринте"]
            en: ["completed", "done", "finished in sprint"]

      - name: avg_committed_points
        sql: committed_points
        type: avg
        title: Avg Committed Points per Sprint

      - name: avg_completed_points
        sql: completed_points
        type: avg
        title: Avg Completed Points per Sprint

      - name: avg_velocity
        sql: completed_points
        type: avg
        title: Avg Velocity (Completed Points)
        meta:
          keywords:
            ru: ["velocity", "скорость", "средняя скорость команды"]
            en: ["velocity", "speed", "average team velocity"]
          question_templates:
            - "velocity по спринтам"
            - "скорость команды"
            - "committed vs completed"

      - name: total_added_points
        sql: added_points
        type: sum
        title: Total Added Points (Scope Creep)
        meta:
          keywords:
            ru: ["добавлено", "scope creep", "изменение скоупа"]
            en: ["added", "scope creep", "scope change"]

      - name: total_removed_points
        sql: removed_points
        type: sum
        title: Total Removed Points

      - name: avg_completion_rate
        sql: completion_rate_pct
        type: avg
        title: Avg Completion Rate (%)
        meta:
          keywords:
            ru: ["процент выполнения", "completion rate", "выполнено процентов"]
            en: ["completion rate", "percent completed", "done percentage"]

      - name: total_issues_completed
        sql: issues_completed
        type: sum
        title: Total Issues Completed

      - name: total_issues_not_completed
        sql: issues_not_completed
        type: sum
        title: Total Issues Not Completed

      - name: sprint_count
        type: count
        title: Sprint Count
