cubes:
  - name: retail_transactions
    sql_table: retail.fact_transactions
    title: Retail Transactions
    description: |
      Факты транзакций розничной торговли.
      KPI: Revenue, Order count, Avg order value, Items sold.
    
    meta:
      keywords:
        ru: ["транзакции", "продажи", "заказы", "выручка", "revenue"]
        en: ["transactions", "sales", "orders", "revenue"]
      intent: analytics

    joins:
      - name: retail_customers
        sql: "{CUBE}.customer_id = {retail_customers}.customer_id"
        relationship: many_to_one

      - name: retail_products
        sql: "{CUBE}.product_id = {retail_products}.product_id"
        relationship: many_to_one

    dimensions:
      - name: transaction_id
        sql: transaction_id
        type: number
        primary_key: true
        title: Transaction ID

      - name: invoice_no
        sql: invoice_no
        type: string
        title: Invoice Number
        meta:
          keywords:
            ru: ["номер заказа", "счет"]
            en: ["invoice", "order number"]

      - name: customer_id
        sql: customer_id
        type: number
        title: Customer ID

      - name: product_id
        sql: product_id
        type: number
        title: Product ID

      - name: quantity
        sql: quantity
        type: number
        title: Quantity

      - name: unit_price
        sql: unit_price
        type: number
        title: Unit Price

      - name: country
        sql: country
        type: string
        title: Country
        meta:
          keywords:
            ru: ["страна", "по странам"]
            en: ["country", "by country"]
          filter: true

      - name: invoice_date
        sql: invoice_date
        type: time
        title: Invoice Date
        meta:
          keywords:
            ru: ["дата", "за период", "за месяц", "за неделю"]
            en: ["date", "for period", "by month", "by week"]
          supports_date_range: true

      - name: invoice_week
        sql: "DATE_TRUNC('week', invoice_date)"
        type: time
        title: Invoice Week

      - name: invoice_month
        sql: "DATE_TRUNC('month', invoice_date)"
        type: time
        title: Invoice Month

    measures:
      - name: transaction_count
        type: count
        title: Transaction Count
        meta:
          keywords:
            ru: ["количество транзакций", "сколько транзакций"]
            en: ["transaction count", "how many transactions"]

      - name: order_count
        sql: invoice_no
        type: count_distinct
        title: Order Count (Unique Invoices)
        meta:
          keywords:
            ru: ["количество заказов", "сколько заказов"]
            en: ["order count", "how many orders"]

      - name: total_revenue
        sql: total_amount
        type: sum
        title: Total Revenue
        meta:
          keywords:
            ru: ["выручка", "revenue", "доход", "продажи", "сумма продаж"]
            en: ["revenue", "sales", "total sales", "income"]
          question_templates:
            - "какая выручка"
            - "сколько продали"
            - "total revenue"

      - name: total_quantity
        sql: quantity
        type: sum
        title: Total Quantity Sold
        meta:
          keywords:
            ru: ["количество проданных", "сколько продано штук"]
            en: ["quantity sold", "items sold"]

      - name: avg_order_value
        sql: total_amount
        type: avg
        title: Average Order Value
        meta:
          keywords:
            ru: ["средний чек", "средняя стоимость заказа"]
            en: ["average order value", "avg order", "aov"]

      - name: avg_unit_price
        sql: unit_price
        type: avg
        title: Average Unit Price

      - name: unique_customers
        sql: customer_id
        type: count_distinct
        title: Unique Customers
        meta:
          keywords:
            ru: ["уникальных клиентов", "сколько клиентов купило"]
            en: ["unique customers", "customer count"]

      - name: unique_products
        sql: product_id
        type: count_distinct
        title: Unique Products Sold
