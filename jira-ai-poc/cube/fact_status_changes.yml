cubes:
  - name: fact_status_changes
    sql_table: public.fact_issue_status_changes
    title: Status Changes Analytics
    description: |
      История изменений статусов для расчета cycle time и reopen rate.
      KPI: Reopen Rate, Status Flow analysis.
    
    meta:
      keywords:
        ru: ["статусы", "изменения статусов", "reopen", "переоткрытие", "flow"]
        en: ["statuses", "status changes", "reopen", "reopened", "flow"]
      intent: analytics

    dimensions:
      - name: change_id
        sql: change_id
        type: number
        primary_key: true

      - name: issue_id
        sql: issue_id
        type: number

      - name: issue_key
        sql: issue_key
        type: string
        title: Issue Key

      - name: project_id
        sql: project_id
        type: number

      - name: project_key
        sql: project_key
        type: string
        title: Project Key
        meta:
          keywords:
            ru: ["проект", "по проекту"]
            en: ["project", "by project"]
          filter: true

      - name: project_name
        sql: project_name
        type: string
        title: Project Name

      - name: changed_by_name
        sql: changed_by_name
        type: string
        title: Changed By

      - name: old_status_name
        sql: old_status_name
        type: string
        title: Old Status

      - name: new_status_name
        sql: new_status_name
        type: string
        title: New Status

      - name: old_status_category
        sql: old_status_category
        type: string

      - name: new_status_category
        sql: new_status_category
        type: string

      - name: is_reopen
        sql: is_reopen
        type: boolean
        title: Is Reopen
        meta:
          keywords:
            ru: ["reopen", "переоткрыто", "вернулось"]
            en: ["reopen", "reopened", "returned"]

      - name: is_to_done
        sql: is_to_done
        type: boolean

      - name: is_start_work
        sql: is_start_work
        type: boolean

      - name: changed_at
        sql: changed_at
        type: time
        title: Changed At
        meta:
          keywords:
            ru: ["когда", "за период", "за неделю"]
            en: ["when", "for period", "last week"]
          supports_date_range: true

      - name: changed_week
        sql: changed_week
        type: time
        title: Changed Week

    measures:
      - name: total_changes
        type: count
        title: Total Status Changes

      - name: reopen_count
        type: count
        title: Reopen Count
        filters:
          - sql: "{CUBE}.is_reopen = true"
        meta:
          keywords:
            ru: ["reopen", "переоткрытий", "сколько переоткрыто"]
            en: ["reopens", "reopen count", "how many reopened"]
          question_templates:
            - "сколько задач переоткрыто"
            - "reopen rate"

      - name: completed_transitions
        type: count
        title: Completed Transitions
        filters:
          - sql: "{CUBE}.is_to_done = true"

      - name: work_started_count
        type: count
        title: Work Started Count
        filters:
          - sql: "{CUBE}.is_start_work = true"

      - name: issues_with_reopens
        sql: issue_id
        type: count_distinct
        title: Issues with Reopens
        filters:
          - sql: "{CUBE}.is_reopen = true"

      - name: issues_completed
        sql: issue_id
        type: count_distinct
        title: Unique Issues Completed
        filters:
          - sql: "{CUBE}.is_to_done = true"
